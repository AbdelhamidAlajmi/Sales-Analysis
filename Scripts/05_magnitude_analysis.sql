-- Magnitude Analysis
-- Find the total customers by countries
SELECT
	COUNTRY,
	COUNT(CUSTOMER_ID) AS NUM_CUSTOMERS
FROM
	DIM_CUSTOMERS
GROUP BY
	COUNTRY
ORDER BY
	NUM_CUSTOMERS DESC;

-- Find The Total Customers by gender
SELECT
	GENDER,
	COUNT(CUSTOMER_ID) AS NUM_CUSTOMERS
FROM
	DIM_CUSTOMERS
GROUP BY
	GENDER
ORDER BY
	NUM_CUSTOMERS DESC;

-- Find the total products by category
SELECT
	CATEGORY,
	COUNT(PRODUCT_ID) AS NUM_PRODUCTS
FROM
	DIM_PRODUCTS
GROUP BY
	CATEGORY
ORDER BY
	NUM_PRODUCTS DESC;

-- What's the average costs in each category
SELECT
	CATEGORY,
	ROUND(AVG(COST), 2) AS AVG_COST
FROM
	DIM_PRODUCTS
GROUP BY
	CATEGORY
ORDER BY
	AVG_COST DESC;

-- What's the total revenue generated for each category?
SELECT
	P.CATEGORY,
	SUM(S.SALES_AMOUNT) AS TOT_REV
FROM
	FACT_SALES S
	JOIN DIM_PRODUCTS P ON S.PRODUCT_KEY = P.PRODUCT_KEY
GROUP BY
	P.CATEGORY
ORDER BY
	TOT_REV DESC;

-- What's the total revenue generated by each customer
SELECT
	C.CUSTOMER_KEY,
	C.FIRST_NAME,
	C.LAST_NAME,
	SUM(S.SALES_AMOUNT) AS TOT_REV
FROM
	FACT_SALES S
	JOIN DIM_CUSTOMERS C ON S.CUSTOMER_KEY = C.CUSTOMER_KEY
GROUP BY
	C.CUSTOMER_KEY,
	C.FIRST_NAME,
	C.LAST_NAME
ORDER BY
	TOT_REV DESC;

-- What's the distribution of sold items across countries
SELECT
	C.COUNTRY,
	COUNT(S.QUANTITY) AS NUM_SOLD_ITEMS
FROM
	FACT_SALES S
	JOIN DIM_CUSTOMERS C ON S.CUSTOMER_KEY = C.CUSTOMER_KEY
GROUP BY
	C.COUNTRY
ORDER BY
	NUM_SOLD_ITEMS DESC;
